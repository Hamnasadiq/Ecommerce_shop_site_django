{% extends 'shop/background.html' %}
{% load static %}

{% block title %}Checkout â€” Shopix{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="checkout-container glass-card">

    <!-- Cart Items -->
    <h3 style="font-weight:700; color:var(--text-dark);">
      <i class="fa-solid fa-cart-shopping me-2"></i> Your Cart
    </h3>
    <div class="mb-4 mt-3" id="item_list"></div>

    <!-- Shipping Form -->
    <h4 style="font-weight:700; color:var(--text-dark);" class="mt-4 mb-3">
      <i class="fa-solid fa-truck me-2"></i> Shipping Information
    </h4>

    <form method="POST">
      {% csrf_token %}
      <input type="hidden" id="items" name="items">

      <div class="row mb-3 g-3">
        <div class="col-md-6">
          <label for="name" class="form-label">Full Name</label>
          <input id="name" name="name" type="text" class="form-control"
            placeholder="John Doe" required>
        </div>
        <div class="col-md-6">
          <label for="email" class="form-label">Email</label>
          <input id="email" name="email" type="email" class="form-control"
            placeholder="john@example.com" required>
        </div>
      </div>

      <div class="mb-3">
        <label for="address" class="form-label">Address</label>
        <input id="address" name="address" type="text" class="form-control"
          placeholder="1234 Main St" required>
      </div>

      <div class="row mb-3 g-3">
        <div class="col-md-4">
          <label for="city" class="form-label">City</label>
          <input id="city" name="city" type="text" class="form-control" required>
        </div>
        <div class="col-md-4">
          <label for="state" class="form-label">State</label>
          <input id="state" name="state" type="text" class="form-control" required>
        </div>
        <div class="col-md-4">
          <label for="zipcode" class="form-label">Zip Code</label>
          <input id="zipcode" name="zipcode" type="text" class="form-control" required>
        </div>
      </div>

      <div class="mb-3">
        <label for="total" class="form-label">Amount to Pay</label>
        <input readonly type="text" class="form-control" id="total" name="total"
          style="font-weight:700; color:var(--primary); font-size:1.1rem;">
      </div>

      <button type="submit" class="btn btn-theme-solid mt-2"
        style="padding:12px 36px; font-size:1rem;">
        <i class="fa-solid fa-credit-card me-2"></i> Place Order
      </button>
    </form>

  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  let cart = localStorage.getItem('cart') ? JSON.parse(localStorage.getItem('cart')) : {};
  let total = 0;
  const itemList = document.getElementById('item_list');

  for (let item in cart) {
    let quantity = cart[item][0];
    let name = cart[item][1];
    let price = cart[item][2];
    total += price * quantity;

    itemList.innerHTML += `
      <div class="cart-item">
        <span class="item-name">
          <strong>${quantity}x</strong> ${name}
        </span>
        <span class="item-price">$ ${(price * quantity).toFixed(2)}</span>
      </div>`;
  }

  if (Object.keys(cart).length === 0) {
    itemList.innerHTML = `
      <div class="text-center py-4" style="color:var(--text-muted);">
        <i class="fa-solid fa-cart-shopping fa-2x mb-2"></i>
        <p>Your cart is empty</p>
        <a href="/" class="btn btn-theme">Continue Shopping</a>
      </div>`;
  } else {
    itemList.innerHTML += `
      <div class="cart-total">
        <span>Total</span>
        <span>$ ${total.toFixed(2)}</span>
      </div>`;
  }

  document.getElementById('total').value = total.toFixed(2);
  document.getElementById('items').value = JSON.stringify(cart);
</script>
{% endblock %}
